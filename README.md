# django-logs-analyzer

**Django Logs Analyzer** – это CLI-приложение для анализа логов Django-приложений и формирования консольных отчётов. Данное приложение позволяет собирать данные из одного или нескольких файлов логов, обрабатывать их и выводить агрегированные результаты анализа.

## Функциональные возможности

- **Анализ нескольких файлов логов.**  
  При выполнении анализа можно передавать пути к нескольким файлам логов. Каждый файл обрабатывается отдельно, а затем данные объединяются для формирования итогового отчёта.

- **Гибкий выбор отчёта.**  
  Приложению можно передать аргумент `--report` с названием отчёта, который необходимо сформировать. Сейчас реализован единственный отчёт `handlers`, но архитектура проекта позволяет легко добавлять новые отчёты.

- **Формирование отчёта “handlers”.**  
  Данный отчёт собирает статистику по API-ручкам на основе логов, формируемых модулем `django.requests`. Отчёт включает:
  - Количество запросов к каждой ручке, сгруппированных по уровням логирования (DEBUG, INFO, WARNING, ERROR, CRITICAL).
  - Сортировку ручек в алфавитном порядке.
  - Общую сводную строку с подсчитанным итоговым количеством запросов для каждого уровня логирования.

## Пример использования

Рассмотрим пример формирования отчёта с именем `handlers` для нескольких файлов логов из папки logs в этом репозитории:

```bash
python3 main.py logs/app1.txt logs/app2.txt logs/app3.txt --report handlers
```

Пример вывода:
```
Total requests: 188

HANDLER                        DEBUG      INFO       WARNING    ERROR      CRITICAL
/admin/dashboard/              0          13         0          4          0
/admin/login/                  0          12         0          4          0
/api/v1/auth/login/            0          12         0          2          0
/api/v1/cart/                  0          9          0          1          0
/api/v1/checkout/              0          15         0          4          0
/api/v1/orders/                0          10         0          4          0
/api/v1/payments/              0          12         0          2          0
/api/v1/products/              0          12         0          5          0
/api/v1/reviews/               0          20         0          4          0
/api/v1/shipping/              0          8          0          3          0
/api/v1/support/               0          16         0          4          0
/api/v1/users/                 0          9          0          3          0
```

## Добавление новых видов отчетов

Архитектура приложения четко разделяет этап парсинга логов (все что внутри parse_logs.py) и этап формирования отчетов (reports.py, filter_requests.py).
Это разделение позволяет предельно просто расширять возможный набор отчетов: любой новый тип отчёта, например, отчёт по безопасности, можно реализовать путем анализа атрибутов объекта DjangoLog (например, найти все отчеты связанный с безопастностью: `source == "security"`), а затем агрегировать и форматировать результаты. Допустим, нам необходимо определить количество логов, связанных с безопастностью (`django.sercurity`). Тогда, все что нам нужно сделать, это в файле `reports.py` создать новую функцию:
```python
def security_report(files: list[str]) -> str:
    logs = parse_logs_files(files)
    security_logs = [log for log in logs if log.source == "security"]
    return f"Security logs count: {len(logs)}"
```
После чего импортировать её в `main.py` и добавить обработку нового отчета:
```python
match args.report:
    case "handlers":
        print(handlers_report(args.files))
    case "security":
        print(security_report(args.files))
```
